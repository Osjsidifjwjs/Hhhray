--// Servi√ßos
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

--// Remote
local REUseItem = ReplicatedStorage.Packages.Net["RE/UseItem"]

--// Player Local
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Root = Character:WaitForChild("HumanoidRootPart")

--// ‚ö†Ô∏è CONFIGURA√á√ïES - EDITE AQUI ‚ö†Ô∏è
local ShootDelay = 4 -- SEGUNDOS entre cada tiro do LASER
local DelayEntreArmoETorso = 3.5 -- Delay entre tiro no bra√ßo e torso (LASER)
local DistanciaAutoShoot = 7 -- Dist√¢ncia para ativar auto-shoot
local ForcaImpulso = 27.4 -- For√ßa do impulso da parede (ajuste aqui)
local DistanciaParede = 3 -- Dist√¢ncia da parede atr√°s de voc√™
local ForcaPulo = 85 -- For√ßa extra do impulso ao pular (ajuste aqui)
local GravidadeQueda = 10 -- Gravidade durante a queda (quanto menor, mais lento cai)

--// üé® CONFIGURA√á√ÉO DE IMAGEM DO ROBLOX
local SeuUserIdRoblox = 1 -- COLOQUE SEU USER ID AQUI (exemplo: 156 para Builderman)

--// Vari√°veis globais
local ScriptEnabled = false
local TargetPlayer = nil
local ChaoAtivo = false
local chaoPart
local AutoShootEnabled = false
local ClickToShootEnabled = false
local PegaNaMaoEnabled = false
local ParedeAtiva = false
local paredePart
local ImpulsoPuloAtivo = false
local jumpConnection
local GravidadeBaixaAtiva = false
local gravidadeConnection

--// Sistema ESP
local Camera = workspace.CurrentCamera
local ESP = {}
local ESPEnabled = false

--// Sistema de Bot√µes 3D
local PlayerButtons = {}

--// Vari√°veis do Menu
local MenuVisible = true

--// Refer√™ncias dos Toggles
local ParedeToggle = nil
local ImpulsoToggle = nil

--// Criando ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ModernMenu"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

--// Fun√ß√£o para criar cantos arredondados
local function CreateCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 0) -- Cantos retos por padr√£o
    corner.Parent = parent
end

--// Fun√ß√£o para criar gradiente RGB (Vermelho e Preto)
local function CreateGradient(parent)
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 10, 10)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 5, 5))
    }
    gradient.Rotation = 45
    gradient.Parent = parent
    return gradient
end

--// Fun√ß√£o para criar borda RGB animada
local function CreateRGBBorder(parent)
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Color3.fromRGB(255, 0, 0)
    stroke.Parent = parent
    
    -- Anima√ß√£o RGB (Vermelho <-> Preto)
    task.spawn(function()
        local t = 0
        while parent and parent.Parent do
            t = t + 0.02
            local red = math.floor(127.5 + 127.5 * math.sin(t))
            stroke.Color = Color3.fromRGB(red, 0, 0)
            task.wait(0.03)
        end
    end)
    
    return stroke
end

--// Frame Principal (UI Vermelha Retangular)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 380, 0, 520)
MainFrame.Position = UDim2.new(0.5, -190, 0.5, -260)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 5, 5)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Parent = ScreenGui
CreateCorner(MainFrame, 0) -- Cantos retos
CreateRGBBorder(MainFrame)

--// Sombra
local Shadow = Instance.new("ImageLabel")
Shadow.Name = "Shadow"
Shadow.Size = UDim2.new(1, 30, 1, 30)
Shadow.Position = UDim2.new(0, -15, 0, -15)
Shadow.BackgroundTransparency = 1
Shadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
Shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
Shadow.ImageTransparency = 0.5
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(10, 10, 10, 10)
Shadow.ZIndex = 0
Shadow.Parent = MainFrame

--// Header com gradiente vermelho
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Size = UDim2.new(1, 0, 0, 60)
Header.BackgroundColor3 = Color3.fromRGB(50, 10, 10)
Header.BorderSizePixel = 0
Header.Parent = MainFrame
CreateCorner(Header, 0)
CreateGradient(Header)
CreateRGBBorder(Header)

--// √çcone com sua foto do Roblox
local Icon = Instance.new("ImageLabel")
Icon.Size = UDim2.new(0, 40, 0, 40)
Icon.Position = UDim2.new(0, 15, 0, 10)
Icon.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
Icon.Image = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. SeuUserIdRoblox .. "&width=150&height=150&format=png"
Icon.BorderSizePixel = 0
Icon.Parent = Header
CreateCorner(Icon, 0)
CreateRGBBorder(Icon)

--// T√≠tulo
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -120, 1, 0)
Title.Position = UDim2.new(0, 65, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "LASER CONTROL PRO"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

--// Vers√£o
local Version = Instance.new("TextLabel")
Version.Size = UDim2.new(1, -120, 0, 15)
Version.Position = UDim2.new(0, 65, 1, -20)
Version.BackgroundTransparency = 1
Version.Text = "v2.1 ‚Ä¢ Blood Edition"
Version.TextColor3 = Color3.fromRGB(200, 50, 50)
Version.TextSize = 11
Version.Font = Enum.Font.Gotham
Version.TextXAlignment = Enum.TextXAlignment.Left
Version.Parent = Header

--// Bot√£o Minimizar
local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
MinimizeBtn.Position = UDim2.new(1, -70, 0, 15)
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
MinimizeBtn.Text = "‚àí"
MinimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeBtn.TextSize = 20
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Parent = Header
CreateCorner(MinimizeBtn, 0)
CreateRGBBorder(MinimizeBtn)

--// Bot√£o Fechar
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 15)
CloseBtn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
CloseBtn.Text = "‚úï"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 16
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.BorderSizePixel = 0
CloseBtn.Parent = Header
CreateCorner(CloseBtn, 0)
CreateRGBBorder(CloseBtn)

--// Container de Conte√∫do
local Content = Instance.new("ScrollingFrame")
Content.Name = "Content"
Content.Size = UDim2.new(1, -30, 1, -80)
Content.Position = UDim2.new(0, 15, 0, 70)
Content.BackgroundTransparency = 1
Content.ScrollBarThickness = 4
Content.ScrollBarImageColor3 = Color3.fromRGB(139, 0, 0)
Content.BorderSizePixel = 0
Content.CanvasSize = UDim2.new(0, 0, 0, 0)
Content.Parent = MainFrame

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
ContentLayout.Padding = UDim.new(0, 12)
ContentLayout.Parent = Content

--// Sistema de Arrastar
local dragging = false
local dragInput, dragStart, startPos

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

--// Fun√ß√£o para criar se√ß√£o
local function CreateSection(parent, text, icon)
    local section = Instance.new("Frame")
    section.Name = "Section"
    section.Size = UDim2.new(1, 0, 0, 30)
    section.BackgroundTransparency = 1
    section.Parent = parent
    
    local iconLabel = Instance.new("ImageLabel")
    iconLabel.Size = UDim2.new(0, 25, 0, 25)
    iconLabel.Position = UDim2.new(0, 0, 0, 2.5)
    iconLabel.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
    iconLabel.Image = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. SeuUserIdRoblox .. "&width=150&height=150&format=png"
    iconLabel.BorderSizePixel = 0
    iconLabel.Parent = section
    CreateCorner(iconLabel, 0)
    CreateRGBBorder(iconLabel)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -35, 1, 0)
    label.Position = UDim2.new(0, 35, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(220, 80, 80)
    label.TextSize = 14
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = section
    
    return section
end

--// Fun√ß√£o para criar Toggle Moderno
local function CreateToggle(parent, text, subtitle, callback)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Name = "ToggleFrame"
    toggleFrame.Size = UDim2.new(1, 0, 0, subtitle and 65 or 50)
    toggleFrame.BackgroundColor3 = Color3.fromRGB(40, 10, 10)
    toggleFrame.BorderSizePixel = 0
    toggleFrame.Parent = parent
    CreateCorner(toggleFrame, 0)
    CreateGradient(toggleFrame)
    CreateRGBBorder(toggleFrame)
    
    local toggleLabel = Instance.new("TextLabel")
    toggleLabel.Size = UDim2.new(1, -80, 0, 20)
    toggleLabel.Position = UDim2.new(0, 15, 0, subtitle and 10 or 15)
    toggleLabel.BackgroundTransparency = 1
    toggleLabel.Text = text
    toggleLabel.TextColor3 = Color3.fromRGB(255, 200, 200)
    toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    toggleLabel.TextSize = 14
    toggleLabel.Font = Enum.Font.GothamBold
    toggleLabel.Parent = toggleFrame
    
    if subtitle then
        local subLabel = Instance.new("TextLabel")
        subLabel.Size = UDim2.new(1, -80, 0, 15)
        subLabel.Position = UDim2.new(0, 15, 0, 32)
        subLabel.BackgroundTransparency = 1
        subLabel.Text = subtitle
        subLabel.TextColor3 = Color3.fromRGB(180, 80, 80)
        subLabel.TextXAlignment = Enum.TextXAlignment.Left
        subLabel.TextSize = 11
        subLabel.Font = Enum.Font.Gotham
        subLabel.Parent = toggleFrame
    end
    
    local toggleBg = Instance.new("Frame")
    toggleBg.Size = UDim2.new(0, 50, 0, 26)
    toggleBg.Position = UDim2.new(1, -60, 0.5, -13)
    toggleBg.BackgroundColor3 = Color3.fromRGB(80, 0, 0)
    toggleBg.BorderSizePixel = 0
    toggleBg.Parent = toggleFrame
    CreateCorner(toggleBg, 0)
    CreateRGBBorder(toggleBg)
    
    local toggleCircle = Instance.new("Frame")
    toggleCircle.Size = UDim2.new(0, 20, 0, 20)
    toggleCircle.Position = UDim2.new(0, 3, 0, 3)
    toggleCircle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
    toggleCircle.BorderSizePixel = 0
    toggleCircle.Parent = toggleBg
    CreateCorner(toggleCircle, 0)
    
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(1, 0, 1, 0)
    toggleBtn.BackgroundTransparency = 1
    toggleBtn.Text = ""
    toggleBtn.Parent = toggleBg
    
    local isEnabled = false
    
    local function SetToggleState(value)
        isEnabled = value
        
        local targetColor = isEnabled and Color3.fromRGB(139, 0, 0) or Color3.fromRGB(80, 0, 0)
        local targetPos = isEnabled and UDim2.new(1, -23, 0, 3) or UDim2.new(0, 3, 0, 3)
        
        TweenService:Create(toggleBg, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
        TweenService:Create(toggleCircle, TweenInfo.new(0.2), {Position = targetPos}):Play()
        
        callback(isEnabled)
    end
    
    toggleBtn.MouseButton1Click:Connect(function()
        SetToggleState(not isEnabled)
    end)
    
    -- Retorna a fun√ß√£o para controlar externamente
    return {
        SetState = SetToggleState,
        GetState = function() return isEnabled end
    }
end

--// Sistema ESP CORRIGIDO
function CreateESP(player)
    if player == LocalPlayer then return end
    if ESP[player] then return end

    local line = Drawing.new("Line")
    line.Thickness = 2
    line.Color = Color3.fromRGB(88, 101, 242)
    line.Visible = false
    line.Transparency = 1

    local nameTag = Drawing.new("Text")
    nameTag.Size = 18
    nameTag.Center = true
    nameTag.Outline = true
    nameTag.Color = Color3.fromRGB(255, 255, 255)
    nameTag.Visible = false
    nameTag.Transparency = 1

    ESP[player] = {line = line, name = nameTag}
end

local function UpdateESP()
    if not ESPEnabled then 
        for _, espData in pairs(ESP) do
            if espData.line then espData.line.Visible = false end
            if espData.name then espData.name.Visible = false end
        end
        return 
    end

    for player, espData in pairs(ESP) do
        pcall(function()
            if player and player.Parent and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = player.Character.HumanoidRootPart
                local vector, onScreen = Camera:WorldToViewportPoint(hrp.Position)

                if onScreen and vector.Z > 0 then
                    espData.line.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                    espData.line.To = Vector2.new(vector.X, vector.Y)
                    espData.line.Visible = true

                    espData.name.Position = Vector2.new(vector.X, vector.Y - 30)
                    espData.name.Text = player.Name
                    espData.name.Visible = true
                else
                    espData.line.Visible = false
                    espData.name.Visible = false
                end
            else
                espData.line.Visible = false
                espData.name.Visible = false
            end
        end)
    end
end

local function ToggleESP(enabled)
    ESPEnabled = enabled
    if enabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    else
        for _, espData in pairs(ESP) do
            if espData.line then espData.line.Visible = false end
            if espData.name then espData.name.Visible = false end
        end
    end
end

RunService.RenderStepped:Connect(function()
    UpdateESP()
end)

--// Sistema de Sele√ß√£o de Players no Menu
local PlayerListFrame = nil
local PlayerListButtons = {}

local function CreatePlayerList()
    if PlayerListFrame then return end
    
    PlayerListFrame = Instance.new("Frame")
    PlayerListFrame.Name = "PlayerListFrame"
    PlayerListFrame.Size = UDim2.new(1, 0, 0, 0)
    PlayerListFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
    PlayerListFrame.BorderSizePixel = 0
    PlayerListFrame.Visible = false
    PlayerListFrame.Parent = Content
    CreateCorner(PlayerListFrame, 12)
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 5)
    listLayout.Parent = PlayerListFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0, 10)
    padding.PaddingBottom = UDim.new(0, 10)
    padding.PaddingLeft = UDim.new(0, 10)
    padding.PaddingRight = UDim.new(0, 10)
    padding.Parent = PlayerListFrame
end

local function UpdatePlayerList()
    if not PlayerListFrame then return end
    
    for _, btn in pairs(PlayerListButtons) do
        btn:Destroy()
    end
    PlayerListButtons = {}
    
    local playerCount = 0
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            playerCount = playerCount + 1
            
            local playerBtn = Instance.new("TextButton")
            playerBtn.Name = "Player_" .. player.Name
            playerBtn.Size = UDim2.new(1, 0, 0, 40)
            playerBtn.BackgroundColor3 = Color3.fromRGB(50, 10, 10)
            playerBtn.Text = "üë§ " .. player.Name
            playerBtn.TextColor3 = Color3.fromRGB(220, 80, 80)
            playerBtn.TextSize = 13
            playerBtn.Font = Enum.Font.Gotham
            playerBtn.TextXAlignment = Enum.TextXAlignment.Left
            playerBtn.BorderSizePixel = 0
            playerBtn.AutoButtonColor = false
            playerBtn.Parent = PlayerListFrame
            CreateCorner(playerBtn, 0)
            CreateRGBBorder(playerBtn)
            
            local icon = Instance.new("TextLabel")
            icon.Size = UDim2.new(0, 30, 0, 30)
            icon.Position = UDim2.new(1, -35, 0, 5)
            icon.BackgroundTransparency = 1
            icon.Text = "‚óã"
            icon.TextColor3 = Color3.fromRGB(180, 80, 80)
            icon.TextSize = 20
            icon.Font = Enum.Font.GothamBold
            icon.Parent = playerBtn
            
            local textPadding = Instance.new("UIPadding")
            textPadding.PaddingLeft = UDim.new(0, 15)
            textPadding.Parent = playerBtn
            
            if TargetPlayer == player.Name and ScriptEnabled then
                playerBtn.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
                playerBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
                icon.Text = "‚óè"
                icon.TextColor3 = Color3.fromRGB(255, 255, 255)
            end
            
            playerBtn.MouseEnter:Connect(function()
                if not (TargetPlayer == player.Name and ScriptEnabled) then
                    TweenService:Create(playerBtn, TweenInfo.new(0.15), {
                        BackgroundColor3 = Color3.fromRGB(70, 15, 15)
                    }):Play()
                end
            end)
            
            playerBtn.MouseLeave:Connect(function()
                if not (TargetPlayer == player.Name and ScriptEnabled) then
                    TweenService:Create(playerBtn, TweenInfo.new(0.15), {
                        BackgroundColor3 = Color3.fromRGB(50, 10, 10)
                    }):Play()
                end
            end)
            
            playerBtn.MouseButton1Click:Connect(function()
                print("üéØ Player selecionado: " .. player.Name)
                TargetPlayer = player.Name
                ScriptEnabled = true
                
                for _, otherBtn in pairs(PlayerListButtons) do
                    local otherIcon = otherBtn:FindFirstChildOfClass("TextLabel")
                    TweenService:Create(otherBtn, TweenInfo.new(0.2), {
                        BackgroundColor3 = Color3.fromRGB(50, 10, 10),
                        TextColor3 = Color3.fromRGB(220, 80, 80)
                    }):Play()
                    if otherIcon then
                        otherIcon.Text = "‚óã"
                        otherIcon.TextColor3 = Color3.fromRGB(180, 80, 80)
                    end
                end
                
                TweenService:Create(playerBtn, TweenInfo.new(0.2), {
                    BackgroundColor3 = Color3.fromRGB(139, 0, 0),
                    TextColor3 = Color3.fromRGB(255, 255, 255)
                }):Play()
                icon.Text = "‚óè"
                TweenService:Create(icon, TweenInfo.new(0.2), {
                    TextColor3 = Color3.fromRGB(255, 255, 255)
                }):Play()
                
                print("‚úÖ Laser ATIVADO em: " .. player.Name)
            end)
            
            table.insert(PlayerListButtons, playerBtn)
        end
    end
    
    local frameHeight = math.max(playerCount * 45, 50)
    PlayerListFrame.Size = UDim2.new(1, 0, 0, frameHeight + 20)
end

local function TogglePlayerSelection(enabled)
    ClickToShootEnabled = enabled
    
    if enabled then
        print("üéØ Sele√ß√£o de Players ATIVADA!")
        CreatePlayerList()
        PlayerListFrame.Visible = true
        UpdatePlayerList()
    else
        print("üéØ Sele√ß√£o de Players DESATIVADA!")
        ScriptEnabled = false
        TargetPlayer = nil
        if PlayerListFrame then
            PlayerListFrame.Visible = false
        end
    end
end

--// Sistema de Auto-Shoot por Dist√¢ncia
local LastShot = 0
local ActiveTargets = {}

local function GetNil(Name, DebugId)
    for _, Object in getnilinstances() do
        if Object.Name == Name and Object:GetDebugId() == DebugId then
            return Object
        end
    end
end

local function ShootPlayer(player)
    if player and player.Character then
        local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
        local targetArm = player.Character:FindFirstChild("LeftLowerArm")
        local targetTorso = player.Character:FindFirstChild("Torso") or player.Character:FindFirstChild("UpperTorso")

        if targetRoot then
            if targetArm then
                REUseItem:FireServer(targetRoot.Position, targetArm)
                print("üí• Atirando LASER no bra√ßo de: " .. player.Name)
            end

            if targetTorso then
                task.delay(DelayEntreArmoETorso, function()
                    REUseItem:FireServer(targetRoot.Position, targetTorso)
                    print("üí• Atirando LASER no torso de: " .. player.Name)
                end)
            end
        end
    end
end

local function PegaNaMao(player)
    if player and player.Character then
        local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
        
        if targetRoot then
            local nilPlayer = GetNil(player.Name, player:GetDebugId())
            if nilPlayer then
                REUseItem:FireServer(targetRoot.Position, nilPlayer)
            end
        end
    end
end

task.spawn(function()
    while true do
        RunService.Heartbeat:Wait()
        
        if ScriptEnabled and TargetPlayer and tick() - LastShot >= ShootDelay then
            LastShot = tick()
            local player = Players:FindFirstChild(TargetPlayer)
            if player then
                ShootPlayer(player)
            end
        end
        
        if PegaNaMaoEnabled and TargetPlayer then
            local player = Players:FindFirstChild(TargetPlayer)
            if player then
                PegaNaMao(player)
            end
        end
        
        if AutoShootEnabled and tick() - LastShot >= ShootDelay then
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
                    if targetRoot and Root then
                        local distance = (Root.Position - targetRoot.Position).Magnitude
                        
                        if distance <= DistanciaAutoShoot then
                            if not ActiveTargets[player] then
                                ActiveTargets[player] = true
                                print("‚ö†Ô∏è Player entrou na zona: " .. player.Name)
                            end
                            LastShot = tick()
                            ShootPlayer(player)
                        else
                            if ActiveTargets[player] then
                                ActiveTargets[player] = nil
                                print("‚úÖ Player saiu da zona: " .. player.Name)
                            end
                        end
                    end
                end
            end
        end
    end
end)

--// Fun√ß√µes da Parede Impulsora
local function AtivarParede()
    ParedeAtiva = true
    if not paredePart then
        paredePart = Instance.new("Part")
        paredePart.Size = Vector3.new(8, 10, 1)
        paredePart.Anchored = true
        paredePart.CanCollide = false
        paredePart.BrickColor = BrickColor.new("Electric blue")
        paredePart.Material = Enum.Material.ForceField
        paredePart.Transparency = 0.3
        paredePart.Name = "ParedeImpulsora"
        paredePart.Parent = workspace
    end
    
    task.spawn(function()
        while ParedeAtiva and paredePart do
            local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
            
            if hrp and humanoid then
                local lookVector = hrp.CFrame.LookVector
                paredePart.CFrame = CFrame.new(hrp.Position - (lookVector * DistanciaParede)) 
                    * CFrame.Angles(0, math.atan2(lookVector.X, lookVector.Z), 0)
                
                hrp.AssemblyLinearVelocity = Vector3.new(
                    lookVector.X * ForcaImpulso,
                    hrp.AssemblyLinearVelocity.Y,
                    lookVector.Z * ForcaImpulso
                )
            end
            
            task.wait(0.03)
        end
    end)
end

local function DesativarParede()
    ParedeAtiva = false
    if paredePart then
        paredePart:Destroy()
        paredePart = nil
    end
end

--// Fun√ß√µes do Impulso de Pulo
local function AtivarImpulsoPulo()
    ImpulsoPuloAtivo = true
    print("üöÄ Impulso ao Pular ATIVADO! For√ßa: " .. ForcaPulo)
    
    local function setupJumpBoost()
        local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        
        if humanoid and hrp then
            if jumpConnection then
                jumpConnection:Disconnect()
            end
            
            jumpConnection = humanoid.StateChanged:Connect(function(oldState, newState)
                if ImpulsoPuloAtivo and newState == Enum.HumanoidStateType.Jumping then
                    local currentVelocity = hrp.AssemblyLinearVelocity
                    hrp.AssemblyLinearVelocity = Vector3.new(
                        currentVelocity.X,
                        ForcaPulo,
                        currentVelocity.Z
                    )
                    
                    print("üöÄ IMPULSO aplicado!")
                end
            end)
        end
    end
    
    setupJumpBoost()
    
    LocalPlayer.CharacterAdded:Connect(function()
        if ImpulsoPuloAtivo then
            task.wait(0.5)
            setupJumpBoost()
        end
    end)
end

local function DesativarImpulsoPulo()
    ImpulsoPuloAtivo = false
    print("üöÄ Impulso ao Pular DESATIVADO!")
    if jumpConnection then
        jumpConnection:Disconnect()
        jumpConnection = nil
    end
end

--// Fun√ß√µes da Gravidade Baixa na Queda
local function AtivarGravidadeBaixa()
    GravidadeBaixaAtiva = true
    print("ü™Ç Gravidade Baixa na Queda ATIVADA! Gravidade: " .. GravidadeQueda)
    
    local function setupGravityControl()
        local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        
        if humanoid and hrp then
            if gravidadeConnection then
                gravidadeConnection:Disconnect()
            end
            
            gravidadeConnection = RunService.Heartbeat:Connect(function()
                if not GravidadeBaixaAtiva then return end
                
                local state = humanoid:GetState()
                local velocity = hrp.AssemblyLinearVelocity
                
                -- Verifica se est√° caindo (velocidade Y negativa e no ar)
                if state == Enum.HumanoidStateType.Freefall and velocity.Y < 0 then
                    -- Aplica gravidade reduzida mantendo X e Z
                    hrp.AssemblyLinearVelocity = Vector3.new(
                        velocity.X,
                        math.max(velocity.Y, -GravidadeQueda), -- Limita a velocidade de queda
                        velocity.Z
                    )
                end
                -- Quando tocar no ch√£o, a gravidade volta ao normal automaticamente
            end)
        end
    end
    
    setupGravityControl()
    
    -- Reconectar quando o personagem respawnar
    LocalPlayer.CharacterAdded:Connect(function()
        if GravidadeBaixaAtiva then
            task.wait(0.5)
            setupGravityControl()
        end
    end)
end

local function DesativarGravidadeBaixa()
    GravidadeBaixaAtiva = false
    print("ü™Ç Gravidade Baixa na Queda DESATIVADA!")
    if gravidadeConnection then
        gravidadeConnection:Disconnect()
        gravidadeConnection = nil
    end
end

--// Sistema de Atalhos de Teclado
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    -- Tecla Q - Toggle Parede Impulsora
    if input.KeyCode == Enum.KeyCode.Q then
        if ParedeToggle then
            local newState = not ParedeToggle.GetState()
            ParedeToggle.SetState(newState)
            print("‚å®Ô∏è [Q] Parede Impulsora: " .. (newState and "LIGADA" or "DESLIGADA"))
        end
    end
    
    -- Tecla R - Toggle Impulso de Pulo
    if input.KeyCode == Enum.KeyCode.R then
        if ImpulsoToggle then
            local newState = not ImpulsoToggle.GetState()
            ImpulsoToggle.SetState(newState)
            print("‚å®Ô∏è [R] Impulso de Pulo: " .. (newState and "LIGADO" or "DESLIGADO"))
        end
    end
end)

--// Criando UI
CreateSection(Content, "SISTEMA DE MIRA", "üéØ")

CreateToggle(Content, "Sele√ß√£o de Players", "Clique no nome do player para ativar o laser nele", function(value)
    TogglePlayerSelection(value)
end)

CreateToggle(Content, "Pega na M√£o", "Ativa o 'Pega na M√£o' instantaneamente (use com Sele√ß√£o)", function(value)
    PegaNaMaoEnabled = value
    if value then
        print("‚úã Pega na M√£o ATIVADO! (SEM DELAY)")
    else
        print("‚úã Pega na M√£o DESATIVADO!")
    end
end)

CreateToggle(Content, "Auto-Shoot (Dist√¢ncia)", "Ativa laser automaticamente quando player chega a 7 studs", function(value)
    AutoShootEnabled = value
    if value then
        print("üî´ Auto-Shoot ativado! Dist√¢ncia: " .. DistanciaAutoShoot .. " studs")
    else
        print("üî´ Auto-Shoot desativado!")
        ActiveTargets = {}
    end
end)

CreateSection(Content, "VISUAL & EXTRAS", "üëÅÔ∏è")

CreateToggle(Content, "ESP (Nome + Linha)", "Mostra linhas e nomes dos players", function(value)
    ToggleESP(value)
end)

CreateToggle(Content, "Ch√£o para Fugir", "Cria uma plataforma abaixo de voc√™", function(value)
    ChaoAtivo = value
    if ChaoAtivo then
        if not chaoPart then
            chaoPart = Instance.new("Part")
            chaoPart.Size = Vector3.new(6, 1, 6)
            chaoPart.Anchored = true
            chaoPart.BrickColor = BrickColor.new("Bright red")
            chaoPart.Material = Enum.Material.Neon
            chaoPart.Name = "ChaoParaFugir"
            chaoPart.Parent = workspace
        end
        task.spawn(function()
            while ChaoAtivo and chaoPart do
                local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    chaoPart.Position = hrp.Position - Vector3.new(0, 3, 0)
                end
                task.wait(0.03)
            end
        end)
    else
        if chaoPart then
            chaoPart:Destroy()
            chaoPart = nil
        end
    end
end)

ParedeToggle = CreateToggle(Content, "Parede Impulsora [Q]", "Cria uma parede nas suas costas te empurrando", function(value)
    if value then
        AtivarParede()
    else
        DesativarParede()
    end
end)

ImpulsoToggle = CreateToggle(Content, "Impulso ao Pular [R]", "D√° impulso extra quando voc√™ pula", function(value)
    if value then
        AtivarImpulsoPulo()
    else
        DesativarImpulsoPulo()
    end
end)

CreateToggle(Content, "Gravidade Baixa (Queda)", "Reduz a gravidade quando voc√™ est√° caindo", function(value)
    if value then
        AtivarGravidadeBaixa()
    else
        DesativarGravidadeBaixa()
    end
end)

--// Bot√µes de controle
CloseBtn.MouseButton1Click:Connect(function()
    for player, espData in pairs(ESP) do
        if espData.line then espData.line:Remove() end
        if espData.name then espData.name:Remove() end
    end
    ScreenGui:Destroy()
    if chaoPart then chaoPart:Destroy() end
    if paredePart then paredePart:Destroy() end
    if jumpConnection then jumpConnection:Disconnect() end
    if gravidadeConnection then gravidadeConnection:Disconnect() end
end)

MinimizeBtn.MouseButton1Click:Connect(function()
    MenuVisible = not MenuVisible
    local targetSize = MenuVisible and UDim2.new(0, 380, 0, 520) or UDim2.new(0, 380, 0, 60)
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = targetSize}):Play()
    Content.Visible = MenuVisible
    MinimizeBtn.Text = MenuVisible and "‚àí" or "+"
end)

--// Criar ESP para players existentes
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end

--// Eventos de novos players
Players.PlayerAdded:Connect(function(player)
    CreateESP(player)
    if ClickToShootEnabled and PlayerListFrame and PlayerListFrame.Visible then
        UpdatePlayerList()
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if ESP[player] then
        if ESP[player].line then ESP[player].line:Remove() end
        if ESP[player].name then ESP[player].name:Remove() end
        ESP[player] = nil
    end
    if TargetPlayer == player.Name then
        TargetPlayer = nil
        ScriptEnabled = false
    end
    ActiveTargets[player] = nil
    
    if ClickToShootEnabled and PlayerListFrame and PlayerListFrame.Visible then
        UpdatePlayerList()
    end
end)

--// Atualizar canvas
ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    Content.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 15)
end)

print("‚úÖ LASER CONTROL PRO carregado!")
print("‚öôÔ∏è Delay LASER: " .. ShootDelay .. "s")
print("‚öôÔ∏è Delay bra√ßo‚Üítorso (LASER): " .. DelayEntreArmoETorso .. "s")
print("‚öôÔ∏è Pega na M√£o: SEM DELAY (instant√¢neo)")
print("‚öôÔ∏è Dist√¢ncia auto-shoot: " .. DistanciaAutoShoot .. " studs")
print("‚öôÔ∏è For√ßa da Parede Impulsora: " .. ForcaImpulso)
print("‚öôÔ∏è Dist√¢ncia da Parede: " .. DistanciaParede .. " studs")
print("‚öôÔ∏è For√ßa do Impulso ao Pular: " .. ForcaPulo)
print("‚öôÔ∏è Gravidade na Queda: " .. GravidadeQueda)
print("")
print("‚å®Ô∏è ATALHOS DE TECLADO:")
print("   [Q] - Liga/Desliga Parede Impulsora")
print("   [R] - Liga/Desliga Impulso de Pulo")
